language: cpp
branches:
  only:
  - develop
  - release
  - "/^v[0-9]/"
  - shyft_test_develop_march21
env:
  global:
  - ENCRYPTION_LABEL="6d4541b72666"
  - SOLC_BUILD_TYPE=RelWithDebInfo
  - SOLC_EMSCRIPTEN=Off
  - SOLC_INSTALL_DEPS_TRAVIS=On
  - SOLC_RELEASE=On
  - SOLC_TESTS=On
  - SOLC_STOREBYTECODE=Off
  - SOLC_DOCKER=Off
  matrix:
#Alex Binesh. Added the below line for the Docker login password. This is my docker password
    secure: "ja6hhBnvuJn+DG9NvI6n83fsXBuTsB7IN3whA7WVsvuO8zXsMBoL/RfPSxZAa2ArFzxxhrJoCmjS3GddIJP2q2hR2OS7KkiR7BiC3H2etUZVoBVlxANLCSub5X03yCNT+0oEJlKFLIvf+wRT9o0RY3+aPP6Jgib6fDhxJrbJFQSGJfmL4kF4U0PK1K43bM2YuXRimvLqS9sfPB24b7yl6ZqthRZrJSp1n0tp255LolUfODIKbWRWwX258uMpTXieTPHmckZ61zIKAUDvnVbxmejLhUqrNZQI3vRpENaVj2YZ27I5uBBAD7ICJ8PrzOqMmK1DJLowuGOqFd1CGyXxxyeZo6eFeQlgHhP7m/6cLzx1b6ho5/FXwVieY36nJoDH+Mb9ol/0c+QP7NBuNSdsdS4Kc1RO0qoF6UrwiN4qJoxOLgjR5gNuqJn5TWZcOzU4M7VbgGNbSuc1SV66FkKF26AKlu94r9Ny1KCMMuC9m7rlljT6FyxLPONjwmY29BiRScNZ998opnlt5J2my/VxBN3VM1Kz12mGcWssJSlXtLoQN3MSTgnB+yNCX5MYPHKmtj3S836J00msCf+7M1SAMj8+99Oboy2+VKV9o+Vw4y++YxFTK/oJztACiRvVVXUouiinoVoLXetwly8EyIeMp3ElD3+YxDZmtDioCQkoiu8="

#Alex Binesh. Added the above line for the Docker login password. This is my docker password
matrix:
  include:
  - os: linux
    dist: trusty
    sudo: required
    compiler: gcc
    env:
    - ZIP_SUFFIX=ubuntu-trusty
    - SOLC_STOREBYTECODE=On
  - os: linux
    dist: trusty
    sudo: required
    compiler: clang
    env:
    - ZIP_SUFFIX=ubuntu-trusty-clang
    - SOLC_STOREBYTECODE=On
  - os: linux
    dist: trusty
    sudo: required
    services:
    - docker
    env:
#Alex Binesh. Added the below line for the Docker login credential. This is my docker username
    - username=jaypersanchez
#Alex Binesh. Added the above line for the Docker login credential. This is my docker username
    - SOLC_DOCKER=On
    - SOLC_INSTALL_DEPS_TRAVIS=On
    - SOLC_RELEASE=On
    - SOLC_TESTS=On
  - os: linux
    dist: trusty
    sudo: required
    compiler: gcc
    node_js:
    - '7'
    services:
    - docker
    before_install:
    - nvm install 7
    - nvm use 7
    - docker pull trzeci/emscripten:sdk-tag-1.35.4-64bit
    env:
    - SOLC_EMSCRIPTEN=On
    - SOLC_INSTALL_DEPS_TRAVIS=On
    - SOLC_RELEASE=On
    - SOLC_TESTS=On
    - ZIP_SUFFIX=emscripten
    - SOLC_STOREBYTECODE=On
git:
  depth: 2
cache:
  ccache: true
  directories:
  - boost_1_57_0
  - "$HOME/.local"
install:
- test $SOLC_INSTALL_DEPS_TRAVIS != On || (scripts/install_deps.sh)
- test "$TRAVIS_OS_NAME" != "linux" || (scripts/install_cmake.sh)
- if [ "$TRAVIS_BRANCH" = release -o -n "$TRAVIS_TAG" ]; then echo -n > prerelease.txt;
  else date -u +"nightly.%Y.%-m.%-d" > prerelease.txt; fi
- echo -n "$TRAVIS_COMMIT" > commit_hash.txt
before_script:
  - test $SOLC_EMSCRIPTEN != On || (scripts/build_emscripten.sh)
  - test $SOLC_DOCKER != On || (scripts/docker_build.sh)
  - test $SOLC_RELEASE != On || (scripts/build.sh $SOLC_BUILD_TYPE && scripts/release.sh
  $ZIP_SUFFIX && scripts/create_source_tarball.sh)
script:
  - test $SOLC_STOREBYTECODE != On || (cd $TRAVIS_BUILD_DIR && scripts/bytecodecompare/storebytecode.sh)
deploy:
- provider: script
  script: test $SOLC_EMSCRIPTEN != On || (scripts/release_emscripten.sh)
  skip_cleanup: true
  on:
    branch:
    - develop
    - release
    - shyft_test_develop_march21
- provider: script
  script: test $SOLC_DOCKER != On || (scripts/docker_deploy.sh)
  skip_cleanup: true
  on:
    branch:
    - develop
    - release
    - "/^v\\d/"
    - shyft_test_develop_march21
- provider: releases
  api_key:
    secure: PWH37xVBCF0XiSjl+eH7XIdkrfxZXjzvqF4PiBOnD3VnFz+odrdnIwBmCeBYTHTWF8efpp8fmzWJk2UVq1JcpyZiC+SVxO8dx91W2ia1a+wKrEQuDgkUrZBkl5IQNCv0QS81DDQhliyZEaYh8wHO/7RReyMpGpw2U2u85WkFiZ+LdlHEZPfzUeh9lxQ9n8qwFL8Rja+Q05d4cQ8zaVEtofJJT4T6DUWhc3TzuxDYxOmjwg37rC9CkGSLn6VadSh8b3j5R0SZupFsAEvBL/imBLP9r9ewoo7o4p6By3jwiIgH9yNg7LM618xbffcNaYF/KtLBi9uPHfqF7hRD4PlECz+D0PR78nQItOX5HKm1QMg5kCnghRVCA0IVjpV5fiYQnMLM7dCRv34I5b3zLpa69wQ/GLYB2FViqNUfvPeiZTEeIJ2OmATlFx8AH2JoqpY1XJknWb35+vMfa8LSiJJW++SLWeV+ncC92hrvyZ1cy3trepRRZIfyYepxHifnfdWMkddQUJk5b2WS5Fy/TJLZNPeombnpvRhUC38dsYItarKeXTc6k4oADCEDZ2rgGIcEiqRxXV11Y5xHJekLDWzUs+YJNcCuL4pnAP//LOnbnH2w9rLpwhQYSl0anCd097NivAXQJXO2JI/byIYz1kiCVQWnW6EM8+72mLOklf/Qr8k=
  overwrite: true
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/upload/*"
  skip_cleanup: true
  on:
    all_branches: true
    tags: true
